rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    match /users/{userId} {
      allow read, write, update: if request.auth != null && request.auth.uid == userId;
      
      match /notes/{noteId} {
         allow create: if 
          request.auth != null && 
          request.auth.uid == userId &&
          request.resource.data.content is string &&
          request.resource.data.content.size() <= 10000 &&
          get(/databases/$(database)/documents/users/$(userId)).data.notesCount < 5;
        
        allow update: if 
        	request.auth != null && 
          request.auth.uid == userId && 
					request.resource.data.content is string &&
          request.resource.data.content.size() <= 10000;
          
        allow read, delete: if 
        	request.auth != null &&
        	request.auth.uid == userId;
      }
    }
  }
}